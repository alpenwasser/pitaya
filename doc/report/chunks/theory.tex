\chapter{Theoretical Background} % <<< --------------------------------------- %
\label{ch:analog-to-digital_data_aquisition}
% ---------------------------------------------------------------------------- %

This chapter  will present a  brief synopsis on  some aspects of  digital data
acquisition from  an analog source  and the processing  of that data,  and how
those issues pertain to our project. It  is not intended to be a comprehensive
treatise on the subject but shall serve  as a short refresher. At its end, the
reader should  have sufficient insight  to understand the basic  motivation of
our project from a theoretical point of view.

TODO: references to more comprehensive literature.

\section{The Digital Signal Processing Chain}% <<< --------------------------- %
\label{sec:dsp_chain}

Digitally acquiring a signal generally requires at least the following steps:
\begin{itemize}\tightlist
        \item
            Passing the signal through an analog low-pass filter.
        \item
            Sampling and quantizing the filtered signal.
\end{itemize}

The   resulting   sequence  of   values   can   then  be   further   digitally
processed. The necessary  building blocks  for this  process are  portrayed in
Figure~\ref{fig:dspChain:blocks}.

\begin{figure}
    \centering
    \input{images/dspChain/dspChain.tikz}
    \caption[The DSP Chain]{%
        The basic  building blocks of the  DSP chain from its  analog input to
        its digitally processed output.\protect\newline
        From  left  to  right: The  analog low-pass  filter  (\emph{LP}),  the
        analog-to-digital  converter (\emph{ADC}),  and  an arbitrary  digital
        signal processing  system for further  processing of the  ADC's output
        (\emph{DSP}).%
    }
    \label{fig:dspChain:blocks}
\end{figure}

\begin{figure}
    \centering
    \input{images/dspChain/timeDomain.tikz}
    \input{images/dspChain/freqDomain.tikz}
    \caption[Signals Passing Through the DSP Chain (Simplified)]{%
        Simplified  time-domain  (top)   and  frequency-domain  (bottom)  view
        of  the  signal  at  different  stages on  its  way  through  the  DSP
        chain. The circled  numbers correspond  to the  stages as  outlined in
        Figure~\ref{fig:dspChain:blocks}.\protect\newline
        Stage  1 is  the  signal  before passing  through  the input  low-pass
        filter,  with  a  significant   amount  of  high-frequency  noise. The
        low-pass filter removes any  frequency components above ${f_s}/{2}$ in
        an ideal scenario  (in reality, it merely attenuates them,  as we will
        see later), resulting in the signal at stage 2.\protect\newline
        After having been filtered, the  ADC samples and quantizes the signal,
        yielding  a sequence  of  values, as  schematically  portrayed in  the
        rightmost picture for stage 3.\protect\newline
        Note that  due to the sampling  process, the spectrum of  the filtered
        signal is repeated at intervals of  $f_s/2$. This is the source of the
        issue of \emph{aliasing}.%
    }
    \label{fig:dspChain:signals}
\end{figure}

Of particular  interest for our  application is  what happens in  the ADC. The
quantization process converts a  value-continuous signal into a value-discreet
one,  with its  resolution being  a specification  of the  ADC which  is being
used. As an example, the ADC in our system has a resolution of \num{14}\,bits,
meaning it can divite its valid  input range into \num{16384} values. Given an
input range of \SI{2}{\volt} $V_{PP}$, that equates to a resolution of roughly
\SI{122}{\micro\volt} (in theory). This quantization  process is the source of
what is generally  known as \emph{quantization noise}. For more  on the topic,
see \code{TODO}.

TODO: Check numbers. Give references for further reading.

Besides the quantization,  the other step happening in the  ADC is sampling; a
time-continuous signal is converted into a series of time-discreet values. The
time between those values is known as \emph{sampling time}, its inverse is the
\emph{sampling  frequency}. Note that  usually  these are  constant, at  least
during the  time where the signal  is measured. This need not  strictly be the
case  in theory  though. In our  system, this  sampling frequency  is a  fixed
property of the ADC, and is \SI{125}{\mega\hertz}.

The sampling  step lies  at the  core of  the problem  our project  intends to
address:  \emph{aliasing}. Therefore, we  will take  a  closer look  at a  few
consequences  of the  sampling  process, and  how they  are  relevant to  this
project.

Descriptively, the sampling  process can be thought of as  looking at a signal
at  specific points  in  time and  capturing  its value. Mathematically,  this
amounts to multipliying the  signal with a series of Dirac  pulses in the time
domain,  and  convolving with  a  series  of  Dirac  pulses in  the  frequency
domain\footnotemark.
\footnotetext{%
    \emph{Pro memoria}: A series of Dirac pulses  in the time domain has as its
    spectrum a series of Dirac pulses as well.%
}.
This  convolution  in   the  frequency  domain  lies  at  the   heart  of  the
problem   of  aliasing,   because  it   results  in   the  incoming   signal's
spectrum  being  repeated  at  intervals  of  $f_s$  (see  also:  stage  3  in
Figure~\ref{fig:dspChain:signals}). This is no problem as long as the spectrum
of the incoming signal fits within  the boundaries set by this repetition. But
if  the  spectrum   of  the  incoming  singal  is  too   broad,  two  or  more
recurrences  of  the spectrum  will  overlap. This  effect is  highlighted  in
Figure~\ref{fig:aliasing:band}.

\begin{figure}
    \centering
    \input{images/aliasing/band.tikz}
    \caption[Aliasing Illustrated via Signal Frequency Band]{%
        Simplified view  of a signal  which does not produce  aliasing between
        its recurrences  in the  frequency spectrum  (top), contrasted  with a
        signal whose  frequency band  has components  above half  the sampling
        frequency,  resulting   in  aliasing;  its  spectral   copies  overlap
        (highlighted areas in the bottom plot).%
    }
    \label{fig:aliasing:band}
\end{figure}

This overlap results in two primary problems:
\begin{itemize}\tightlist
    \item
        The digital  signal may not  be unambiguously reconstructable  into an
        analog signal, if that is intended.
    \item
        Frequencies  may occur  in the  digital  signal stream  which are  not
        actually  present  in  the  original  signal. This  problem  is  often
        referred to  as the  \emph{folding back} of  frequency components. See
        Figure~\ref{fig:aliasing:dirac} for an illustration  of how this might
        look.

        This problem is of particular interest  to our application, as we will
        see later.
\end{itemize}

\begin{figure}
    \centering
    \input{images/aliasing/dirac.tikz}
    \caption[Aliasing With Harmonic Signals]{%
        Example  of  two harmonic  signals  being  sampled. In the  top  plot,
        the  signal's  frequency is  below  half  the sampling  frequency  and
        there  is  no  aliasing. The   signal  can  be  reconstructed  without
        error.\protect\newline
        In the bottom plot, the signal's  frequency is above half the sampling
        frequency. Consequently, the copies of the signal's frequency spectrum
        centered around  the sampling  frequency and  its negative  alias back
        into  the  band  between  $-f_s/2$  and  $f_s/2$. If  this  signal  is
        reconstructed, the resulting  signal would have a frequency  of $f_s -
        f_{\mathrm{sig}}$ instead of $f_{\mathrm{sig}}$.%
    }
    \label{fig:aliasing:dirac}
\end{figure}


Once a signal  has left the ADC and  is handed down the DSP  chain for further
processing,  the primary  problem becomes  one of  resources, particularly  in
real-time applications. In  most systems,  the available  hardware is  a fixed
constraint, and depending on what sort of processing is to be conducted on the
digital data stream, the available resources may or may not suffice.

If available resources are found to be insufficient for real-time processing of
the data stream, one may choose to
\begin{itemize}\tightlist
    \item
        not process the data in real time,
    \item
        reduce the complexity of the computations, or
    \item
        reduce the amount of data to be processed through \emph{downsampling}
        of the signal.
\end{itemize}
The  last case  is the  route  which is  chosen in  our application. The  main
constraint on the Red Pitaya is that  the data being generated cannot be moved
off the  device in  real time,  and the  device itself  does not  really offer
sufficient storage for capturing a meaningful amount of data which can then be
moved onto another  device for further processing at  a later point. Therefore
the amount of data must be reduced before  it can be moved off the device to a
computer for viewing or further processing.

TODO: Amount of data being generated on the PITA.

Because downsampling a signal is in  essence nothing more than the sampling of
a signal which has already been sampled, a lot of the considerations which are
valid for the  step from an analog  to a digital signal as  outlined above are
either very  similar or even identical. Specifically,  the same considerations
for  aliasing still  apply: If  the  signal which  is  to  be downsampled  has
frequency components  above $f_{s,  downsampled}/2$, aliasing  will occur. And
since the  signal coming out of  the ADC has the  original signal's (filtered)
spectrum recurring at intervals of its  sampling frequency, this is always the
case.\code{TODO: Correct?}

Therefore,  the sampled  signal must  be  filtered through  a low-pass  filter
before  being downsampled,  just as  the original  analog signal  was low-pass
filtered  before being  passed into  the  ADC. In light  of the  signal to  be
downsampled  being a  \emph{digital} signal  instead  of an  analog one,  that
low-pass filter must  naturally be a digital filter as  well. Designing such a
digital low-pass filter is the core mission of this project.

%>>>

\section{Digital Filters}% <<< ----------------------------------------------- %
\label{sec:digital_filters}

Digital filters can  be distinguished by several  characteristics; common ways
to  categorize them  are by  topology,  impulse response  and their  frequency
response. There  are  two commonly  used  types  of digital  filters: Infinite
impulse   response   (IIR)  filters   and   finite   impulse  response   (FIR)
filters. Another important class of filters are cascaded integrator-comb (CIC)
filters,  however, in  the strictest  sense they  are a  special class  of FIR
filters rather than an entirely new  type of LTI system \cite{1163535}.  While
our system uses FIR and CIC filters,  a brief overview of IIR filters is still
presented here, for the sake of completeness.

\subsection{IIR Filters} %<<< ------------------------------------------------ %
\label{subsec:iir_filters}

Infinite impulse response  filters are so named because  their imulse response
continues  into perpetuity,  never  reaching zero. In  practice, the  response
usually comes  sufficiently close to  zero at a certain  point that it  can be
considered zero for most intents and purposes.

IIR filters have feedback paths, resulting  in a filter response equation with
non-trivial  denominator components. Their  basic  building  blocks are  delay
elements, multipliers and adders.

\begin{equation}
    \label{eq:iir_filter}
    H(z) = \frac{%
            \sum_{k=0}^N b_k \cdot z^{-k}}{%
            1 + \sum_{i=0}^M a_i \cdot z^{-i}}
\end{equation}

TODO: Move sum limits above and below sigma sign.

IIR filters generally require a lower order (and therefore fewer resources) to
approximate a  certain frequency  response specification  than FIR  filters do
(particularly the constraint of a narrow transition band), but this comes at a
cost:  IIR  filters have a  non-linear phase response;  linear-phase responses
can only  be approximated. Furthermore, IIR  filters are not guaranteed  to be
BIBO stable due to their feedback paths.

\begin{figure}
    \centering
    \input{images/filtertopologies/iir.tikz}
    \caption[IIR Filter: Biquad]{Example of an IIR filter topology for a biquad}
    \label{fig:filtertopologies:iir}
\end{figure}

Some of the generally used types of IIR filters are:

\begin{itemize}\tightlist
    \item
        Butterworth  filter: Named after  the British  engineer and  physicist
        Stephen  Butterworth  (1885  --  1958),  who  first  described  it  in
        1930. Characterized by a very flat passband (no passband ripple).
    \item
        Chebyshev filter  (type I  and II): Named after  Russian mathematician
        Pafnuty Chebyshev  (1821 --  1894). They are steeper  than Butterworth
        filters, at the cost of suffering from ripple in the passband (type I)
        or stopband (type II).
    \item
        Bessel  filter: Named for  the German  mathematician Friedrich  Bessel
        (1784 -- 1846). Optimized to have a maximally linear phase response in
        order  to  minimize the  distortion  of  signals passing  through  the
        filter.
    \item
        Elliptical  filters: Also known  as  Cauer filters,  after the  German
        mathematician Wilhelm Cauer (1900 -- 1945), or Zolotarev filter, after
        Russian mathematician Yegor Zolotarev (1847 -- 1878). Characterized by
        equiripple in the  bassband and stopband and a  very narrow transition
        band compared to other filters of the same order.
\end{itemize}

TODO: Check correct dashes for years.

Digital IIR filters are often designed by way of the bilinear transform.

%>>>

\subsection{FIR Filters} %<<< ------------------------------------------------ %
\label{subsec:FIR_filters}

FIR filters are  characterized by an impulse response which  decays to zero in
finite time (see  Figure~\ref{fig:filter_specs:coefs}, unlike IIR filters. The
filter response is characterized by Equation~\ref{eq:fir_filter}:

\begin{equation}
    \label{eq:fir_filter}
    H(z) = \sum_{k=0}^{N} b_k \cdot z^{-k}
\end{equation}

FIR filters have several advantages:

\begin{itemize}\tightlist
    \item
        They are inherently BIBO stable because they lack feedback paths.
    \item
        They  can  be  easily  designed  to  have  a  linear  phase  response,
        preventing signal distortion due to  different group delays for signal
        components of different frequencies.
    \item
        The shape of  their frequency response can be  very finely tuned. This
        makes them ideally  suited for certain purposes,  such as compensation
        filters (see Section~\ref{subsec:CIC_filters}).
    \item
        Implemenation is usually rather straightforward.
\end{itemize}
TODO: Correct?

Their  main  disadvantage   is  that  due  to  the  lack   of  feedback,  they
generally require comparatively high filter  orders for narrow transition band
widths. Illustratively, this can be understood by the following considerations:
\begin{itemize}\tightlist
    \item
        The frequency response of an ideal low-pass filter is the brick wall
        filter, i.e. a rectangle.
    \item
        The inverse  Fourier transform  of a rectangle  is a  $sinc$ function,
        which is infinitely long.
    \item
        Therefore, the impulse  response of the ideal brick  wall filter would
        have an infinite number of taps.
    \item
        Truncation of the number of taps  leads to a deviation of the filter's
        frequency response from the brick wall  filter.  As the number of taps
        (and  therefore the  FIR filter's  impulse response)  is reduced,  its
        frequency response deviates more and  more from the brick wall filter,
        resulting  in  a  flatter  transition between  the  passband  and  the
        stopband as well as the introduction of ripple.
\end{itemize}

This     process     is     illustrated      in     simplified     form     in
Figure~\ref{fig:brick_wall_vs_FIR}.

The  FIR filter's  transition band  width  is particularly  important for  our
application in order to reduce aliasing effects, as will be shown later {TODO:
actually show later}.

\begin{figure}
    \centering
    \input{images/brickwallVsFIR/bwVsFIR.tikz}
    \caption[Brick Wall Filter vs. FIR Filter (simplified)]{%
        The effect of  truncating a $sinc$ function in the  time domain on its
        spectrum (simplified)%
    }
    \label{fig:brick_wall_vs_FIR}
\end{figure}

TODO: Equation for order estimation.

Designing    FIR    filters    is     usually    performed    by    specifying
certain     desired    characteristics     of    the     filter's    frequency
response. Figure~\ref{fig:filter_specs:freqResponse} shows one possible way of
doing this for FIR filters by specifying four constraint parameters:
\begin{itemize}\tightlist
    \item
        pass band ripple: $A_P$
    \item
        stop band attenuation: $A_{St}$
    \item
        pass band edge frequency: $F_P$
    \item
        stop band edge frequency: $F_{St}$
\end{itemize}

The resulting  transition band  width $F_{Tb}$ is  the difference  between the
pass band  edge frequency and  the stop band edge  frequency, and serves  as a
useful indicator of how many coefficients (i.e. resources) the filter will end
up using. Narrower transition bands tend to require a higher filter order, and
therefore  more  resources. Coefficient  counts  of several  hundred  are  not
uncommon for steep FIR filters.

Other sets of  constraint parameters can be used to  design filters, but these
are the ones used in this project, therefore the emphasis on them.

Figure~\ref{fig:filter_specs:coefs}  shows  the   resulting  impulse  response
(coefficient  set)  for  a  FIR  filter  designed  by  using  the  four  above
mentioned parameters, with  values given by Equations~\ref{eq:filter_specs:ap}
through \ref{eq:filter_specs:fst} handed to one  of Matlab's FIR filter design
algorithms.

\begin{align}
    A_P    &= \SI{2}{\dB}   \label{eq:filter_specs:ap}\\
    A_{St} &= \SI{60}{\dB}  \label{eq:filter_specs:ast}\\
    F_P    &= 0.3 \cdot f_s \label{eq:filter_specs:fp}\\
    F_{St} &= 0.4 \cdot f_s \label{eq:filter_specs:fst}
\end{align}

\begin{figure}
    \centering
    \input{images/filterSpecs/freqResponse.tikz}
    \caption[Specifying FIR Filter Constraints]{
        Specifications in the frequency domain and the resulting filter's
        frequency response as designed by Matlab.%
    }
    \label{fig:filter_specs:freqResponse}
\end{figure}

\begin{figure}
    \centering
    \input{images/filterSpecs/coefs.tikz}
    \caption[Impulse Response of a FIR Filter]{
        Impulse    response    (coefficients)     for    the    filter    from
        Figure~\ref{fig:filter_specs:freqResponse}    with   the    parameters
        as     given     by     Equations~\ref{eq:filter_specs:ap}     through
        \ref{eq:filter_specs:fst}    passed   to    one   of    Matlab's   FIR
        filter   design   algorithms,  resulting   in   a   set  of   \num{39}
        coefficients.\protect\newline
        Note that the  coefficients to the left and right  of these values are
        zero, hence \emph{finite} impulse response filters.%
    }
    \label{fig:filter_specs:coefs}
\end{figure}


Figure~\ref{fig:filtertopologies:fir}   shows   one  possible   topology   for
implementing a  FIR filter,  the so-called  direct form. As  can be  seen, the
basic building  blocks of  a FIR  filter are  delay elements,  multipliers and
adders, same as for IIR filters.

\begin{figure}
    \centering
    \input{images/filtertopologies/fir.tikz}
    \caption[FIR Filter Topology Example]
        {One possible topology for a FIR filter (direct form)}
    \label{fig:filtertopologies:fir}
\end{figure}

%>>>

\subsection{CIC Filters} %<<< ------------------------------------------------ %
\label{subsec:CIC_filters}

CIC  filters  were  first  introduced  in 1981  in  \cite{1163535}  by  Eugene
B. Hogenauer. They can be implemented both as decimation filters (reduction in
sampling rate)  and interpolation filters (increase  in sampling rate).

A   CIC  filter   is  a   cascade  of   integrator  and   comb  stages,   with
either   a   sampling    rate   compressor   (in   case    of   a   decimator)
or   a    sampling   rate    expander   (in    case   of    an   interpolator)
between   the   integrator   and   comb   sections.    A   single   integrator
stage   is   shown    in   Figure~\ref{fig:filtertopologies:integrator},   and
Figure~\ref{fig:filtertopologies:comb}   shows   a   single  comb   stage   in
feedforward form. Figure~\ref{fig:filtertopologies:cic}  shows a  complete CIC
filter with three stages.

The integrator stages have a transfer function of
\begin{equation}
    \label{eq:cic:integrator_stage}
    H_I(z) = \frac{1}{1-z^{-1}}
\end{equation}

The comb stages run at the reduced frequency of $f_s/R$ and have the transfer
function
\begin{equation}
    \label{eq:cic:comb_stage}
    H_C(z) = 1 - z^{-RM}
\end{equation}
where  $M$  is the  \emph{differential  delay},  one  of the  filter's  design
parameters.

The  transfer function  of  a  complete CIC  filter  (referenced  to the  high
sampling rate  $f_s$) consisting of $N$  stages is deduced by  multiplying the
transfer functions of the $N$ cascaded integrator and comb stages, yielding
\begin{equation}
    \label{eq:cic:complete}
    H_{CIC}(z) = H_I^N(z) \cdot H_C^N(z) = 
    \frac{\left(1 - z^{-RM}\right)^N}{\left( 1 - z^{-1} \right)^N} =
    \left[\sum_{k = 0}^{RM-1} z^{-k}\right]^N
\end{equation}

Looking at  the last form  of the CIC  filter's transfer function,  it becomes
evident  that it  is in  essence a  FIR filter  with unitary  coefficients. Of
particular note is the fact that this is so despite each stage having feedback
paths and the integrator stages having poles  at $f = 0$ (i.e. the integrators
by themselves  are not in  fact BIBO stable,  even though the  complete system
is). The  fact that  the  resulting filter  has no  poles  can be  intuitively
understood by  looking at the frequency  responses of the integrator  and comb
stages, and finally their cascade.

As  shown  in  the  topmost plot  in  Figure~\ref{fig:cic:freq_responses},  an
integrator is in essence a lowpass filter, with a pole at $f = 0$. As multiple
integrators are cascaded, the slope of the frequency response increases, which
can be seen when comparing the single-stage integrator to the cascade of three
integrators in the plot.

A comb  filter is a  filter which  strongly attenuates one  specific frequency
component  along  with  its  multiples  (in a  notch  comb  filter;  there  is
also  the  inverse  concept  of  a  peak filter  which  only  lets  a  certain
frequency  and multiples  of  it pass). As  can  be seen  in  the middle  plot
of  Figure~\ref{fig:cic:freq_responses}, cascading  multiple comb  stages does
not  change the  location  of the  zeroes,  but merely  changes  shape of  the
magnitude  response along  the vertical  axis. It  is also  evident that  comb
filters  have  no  poles  (a  fact  which can  also  be  easily  deduced  from
Equation~\ref{eq:cic:comb_stage}).

Cascading integrators  and combs results  in the frequency responses  from the
bottom plot from Figure~\ref{fig:cic:freq_responses}. The integrator's pole at
$f = 0$ compensates for the comb  section's zero at the same location, leading
to  a significant,  but  finite, DC  gain  of the  CIC  filter. As the  number
of  stages is  increased,  that  gain increases  accordingly,  along with  the
difference between  the DC  gain and the  filter gain in  the side  lobes (the
slope of the enveloping curve of the entire filter), increasing attenuation of
undesired signal components.

One  serious drawback  of CIC  filtes  is that  they have  no clearly  defined
passband as such. Rather,  their frequency response starts  dropping off right
as the frequency  axis goes beyond zero. This effect  (sometimes also referred
to as \emph{passband droop}) is visible in the magnified section of the bottom
plot in  Figure~\ref{fig:cic:freq_responses}. This means that a  CIC filter by
itself is rarely  a viable solution, since it attenuates  any non-DC frequency
components at least somewhat.

Despite  this drawback,  CIC filters  are well-suited  to large  reductions in
sampling rates because they are  very economical in their resource usage. This
economy is based on six primary factors (see also \cite{1163535}):
\begin{itemize}\tightlist
    \item
        The filter requires no multipliers.
    \item
        There are no filter coefficients which might require storage.
    \item
        The amount  of storage needed  for intermediate results is  reduced by
        running the comb stages at a reduced sampling rate. A conventional FIR
        filter topology implementing the  same transfer function would require
        more resources for storing its intermediate results because the entire
        filter would run at the incoming sampling rate.
    \item
        The  topology of  the  FIR filter  has a  high  degree of  regularity;
        consisting of two  primary building blocks. This lends  itself well to
        optimization.
    \item
        The control logic can be kept simple.
    \item
        The  same  filter  design can  be  used  for  a  large range  of  rate
        change  factors $R$,  requiring  minimal  adaption in  circuitry. This
        effect   can  be   seen   in  the   frequency   response  plotted   in
        Figure~\ref{fig:cic:freq_responses:R3vsR9}.    Despite  the   filter's
        structure  not having  been modified,  the frequency  response changes
        signifiantly  merely by  adjusting $R$. This  can also  be deduced  by
        looking  at  Equation~\ref{eq:cic:comb_stage}. The  order  of  a  comb
        stage, and therefore  the number and placements of  its nulls, depends
        on the rate change factor.
        A  higher rate change factor increases the
        number of lobes in the CIC filter, as well as its DC gain.
\end{itemize}

The frugality of the filter's resource usage makes it ideally suited for being
used at high sampling  frequencies as an initial stage in  a chain of filters,
despite the passband droop in its frequency response.

The  following stages  can  then  be used  to  compensate  for the  distortion
introduced by  the CIC filter. For  those stages, FIR filtes  are well-suited,
since  they run  at much  lower  sampling rates. The  fact that  a FIR  filter
performs many more (and more difficult) computations per sampling cycle than a
CIC filter is therefore no longer as important for overall resource usage; the
FIR filter  has many  more clock  cycles available  for computing  each output
value than the CIC filter.

\begin{figure}
    \centering
    \begin{minipage}[t][][b]{0.45\textwidth}
        \centering
        \input{images/filtertopologies/integrator.tikz}
        \caption[Integrator Stage]{A single integrator stage}
        \label{fig:filtertopologies:integrator}
    \end{minipage}
    \begin{minipage}[t][][b]{0.45\textwidth}
        \centering
        \input{images/filtertopologies/comb.tikz}
        \caption[Comb Stage]{A single comb stage in feedforward form}
        \label{fig:filtertopologies:comb}
    \end{minipage}
\end{figure}

\begin{figure}
    \centering
    \input{images/filtertopologies/cic.tikz}
    \caption[CIC Filter Topology]
        {CIC decimation filter topology with three integrator and comb stages}
    \label{fig:filtertopologies:cic}
\end{figure}

\begin{figure}
    \centering
        \input{images/cic/cicFreqResponses.tikz}
        \caption[Frequency Responses for Integrators, Combs and CIC Filters]{%
            Frequency    respones   for    integrators,   combs    and   their
            combination  into CIC  filters  for  single-stage and  three-stage
            configurations. Both  have   a  rate  change  of   \num{9}  (hence
            \num{4.5} lobes  fitting into the  plot between $f  = 0$ and  $f =
            f_s/2$).\protect\newline
            Note that  the zeroes do  not change  position as comb  stages are
            cascaded. Also, the  frequency response  of the CIC  filter starts
            dropping off immediately, as can  be seen in the magnified section
            of the bottom plot.%
        }
        \label{fig:cic:freq_responses}
\end{figure}

\begin{figure}
    \centering
        \input{images/cic/cicFreqResponsesRvar.tikz}
        \caption[Frequency Responses: CIC w/ $R=9$ vs. $R=3$]{%
            Frequency  responses  for  two  CIC filters  with  different  rate
            changes, but otherwise identical form.%
        }
        \label{fig:cic:freq_responses:R3vsR9}
\end{figure}

As  can  be  seen in  Equation~\ref{eq:cic:integrator_stage},  the  integrator
stages have  unity feedback coefficients. In  the case of CIC  decimators, the
registers of  the integrators  will therefore  suffer from  register overflow.
This is without harm as long as two conditions are fulfilled:
\begin{itemize}\tightlist
    \item
        The filter's  implementation is based  on two's complement  or another
        number system allowing wrap-around between  its most positive and most
        negative numbers.
    \item
        The maximum  magnitude which is expected  at the output is  within the
        range of that number system.
\end{itemize}

A numerical  example to demonstrate this  effect and better explain  the inner
workings  of a  CIC filter  can be  found in  Appendix~\ref{sec:app:cic_simu},
starting on page~\pageref{sec:app:cic_simu}.

Mathematical description,  design parameters, folding back of nulls, register
growth, truncation and rounding, two's complement, \ldots

%>>>
%>>>

\section{A More Detailled Analysis of Aliasing Errors} % <<< ----------------- %
\label{sec:detail_aliasing}

folding back issue

%>>>

%\subsection{Challenges in Downsampling}
%\label{subsec:downsampling}
%
%The most obvious way to downsample from a sequence of values is of course to simply pick
%each nth sample. However, this has some serious drawbacks which make it an unworkable solution
%in most cases.
%
%\textbf{Fancy Graphics of downsampling without LP filter with explanations}
%
%
%\subsection{Digital Low-Pass Filters}
%\label{subsec:digital-lp-filters}
%
%The obvious solution to this predicament is to apply a (digital) low-pass filter to the
%sequence of values before downsampling. For this purpose, three types of filters are commonly
%used, each with their own specific advantages and drawbacks: IIR, FIR, CIC.
%
%For theseandthose reasons, we will use FIR and CIC in our system.
%
%\textbf{Fancy graphics of LP filter, downsampling and folding back}
%
%%>>>
%
%\section{Designing a Filter System}
%\label{sec:designing-a-filter-system}
%
%Talking about which type of filter has which properties is all good and well in theory, but
%how does one actually apply this knowledge to a practical problem? This section answers that
%question insofar as it applies to our project.
%
%\begin{itemize}\tightlist
%    \item
%        limited HW resources
%    \item
%        single-stage vs. multi-stage
%    \item
%        TBW issue with multi-stage
%    \item
%        filters at lower frequencies use fewer resources
%    \item
%        halfband filtres
%    \item
%        CIC: compensation filters
%\end{itemize}

%^^A vim: foldenable foldcolumn=4 foldmethod=marker foldmarker=<<<,>>>
